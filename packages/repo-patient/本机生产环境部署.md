### 本机 生产环境部署
@Author: LuciNyan
@Date: 2019-12-11

    Q: 什么时候需要本机生产环境？
    A: 1. 某些场景第三方需要验证当前URL
          但是 Dev 模式下是「localhost: XXXX」所以无法使用某些第三方功能
          例如支付，某些第三方登录等
       2. 需要本机做生产环境的调试优化
       
    Q: 该部署涉及「后端代码」与「后端数据库」吗?
    A: 不需要，完全不需要涉及到后端的代码和数据库部署，直接由后端服务器提供
       当前后端服务器地址为 114.116.191.172
       
    Q: 需要自己维护后端代码版本吗?
    A: 不需要，后端代码完全与远程服务器一致
       
    Q: 部署前需要哪些准备工作?
    A: 1 编译后生成的前端文件 需要明确其在本机中的绝对路径
       例如 /Users/lucinyan/JiuZhouTong/hospital_p_h5/dist
       2 安装 Nginx
       
       
----- 
- ##### 部署 Step 1
添加 Nginx 配置文件「已配置: Https, Gzip, Service Worker, Cross Site」
```nginx
server {
	listen 443 ssl;
	server_name devpatient.hp.aijiayi.com;


    ###
    # Gzip
    ###

    ## 静态压缩
    gzip_static on;  

    ## 找不到预压缩文件，进行动态压缩  
    gzip on;   
    gzip_min_length 1000;  
    gzip_buffers 4 16k;  
    gzip_comp_level 5;  
    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/vnd.ms-fontobject application/x-font-ttf font/opentype image/svg+xml image/x-icon;

    ## gzip公共配置  
    gzip_http_version 1.1;
    gzip_proxied expired no-cache no-store private auth;  

    ## 对于ie有个bug，响应vary头后将不会缓存请求，每次都会重新发新的请求。所以，对于ie 1-6直接禁用gzip。  
    gzip_disable "MSIE [1-6]\.";
    ## 开启Http Vary头，vary头主要提供给代理服务器使用，根据Vary头做不同的处理。例如，对于支持gzip的请求反向代理缓存服务器将返回gzip内容，不支持gzip的客户端返回原始内容。  
    gzip_vary on;  

	
    ###
    # SSL
    ###

    ## [必须!] ssl 证书
	ssl_certificate   cert/devpatient.hp.aijiayi.com.pem;
	ssl_certificate_key  cert/devpatient.hp.aijiayi.com.key;
	
	ssl_session_timeout 5m;
	ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
	ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
	ssl_prefer_server_ciphers on;

	
    ###
    # Cross Site
    ###

    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods *;
    add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,access-token,devicetype,channelid,nethospitalid';


    ## [需修改!] 根据具体项目目录替换以下路径
	root   		/Users/lucinyan/JiuZhouTong/hospital_p_h5/dist;
	
	index  		index.php index.html;

    
    ## Service Worker
    location = /service-worker.js {
        root /Users/lucinyan/JiuZhouTong/hospital_p_h5/dist;
    }

    # location ^~ /h5/static/ {
    #     rewrite ^/h5/(.+?).(js|css|png|jpg)$ /$1.$2 break;
    # }

    location ^~ /h5 {
        alias /Users/lucinyan/JiuZhouTong/hospital_p_h5/dist/;

        try_files $uri $uri/ /index.html last;
        index  index.html index.htm;
    }

    ## 映射到后端
    location / {
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header Connection "";
        proxy_buffering off;
        proxy_set_header Accept-Encoding "";
        proxy_pass       https://aijiayi_api_cluster/;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        index  index.jsp index.html index.htm index.php;
    }

    ## [需修改! 也可以屏蔽以下两行] 根据具体项目目录替换以下两行路径
    access_log /Users/lucinyan/Log/nginx/aijiayi.com.log;
    error_log  /Users/lucinyan/Log/nginx/aijiayi.com-error.log error;
}

upstream aijiayi_api_cluster {
    ## [可能需修改] 根据具体后端服务器IP修改
    server 114.116.191.172:443;
    keepalive 16;
}


``` 

- ##### 部署 Step 2
根据以上 nginx 文件注释做相应修改

- ##### 部署 Step 3
添加 Hosts
```
127.0.0.1 devpatient.hp.aijiayi.com
```

 
